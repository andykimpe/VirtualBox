From b6d65ab182115fc4785e5d13ddbf72c188a78ac3 Mon Sep 17 00:00:00 2001
From: Lubomir Rintel <lkundrak@v3.sk>
Date: Fri, 18 Jun 2010 10:58:14 +0200
Subject: [PATCH] Do not include statically linked libstdc++

Not a good idea if we don't need to be binary-compatible across exotic
distribution. Doesn't work with trunk glibc heading towards 2.11 anyways.
Static linking is not really supported anyways.
---
 configure                                      |    2 +-
 src/VBox/Additions/x11/VBoxClient/Makefile.kmk |   28 ++++++++++++------------
 2 files changed, 15 insertions(+), 15 deletions(-)

diff --git a/configure b/configure
index ad35434..48d7a94 100755
--- a/configure
+++ b/configure
@@ -2445,7 +2445,7 @@ fi
 if [ "$OS" = "linux" ]; then
   # don't check for the static libstdc++ in the PUEL version as we build the
   # additions at a dedicated box
-  [ $OSE -ge 1 ] && check_staticlibstdcxx
+  #[ $OSE -ge 1 ] && check_staticlibstdcxx
   if [ $WITH_KMODS -eq 1 ]; then
     check_linux
   else
diff --git a/src/VBox/Additions/x11/VBoxClient/Makefile.kmk b/src/VBox/Additions/x11/VBoxClient/Makefile.kmk
index 015a847..469b314 100644
--- a/src/VBox/Additions/x11/VBoxClient/Makefile.kmk
+++ b/src/VBox/Additions/x11/VBoxClient/Makefile.kmk
@@ -69,20 +69,20 @@ endif
 ifdef VBOX_WITH_GUEST_PROPS
  VBoxClient_DEFS += VBOX_WITH_GUEST_PROPS
 endif
-#
-# Link aginst libstdc++.a. (http://www.trilithium.com/johan/2005/06/static-libstdc/).
-# (It would've been preferred to avoid features depending on libstdc++, of course...)
-#
-# Actually, this is darn annoying and will *NOT* be tolerated for any new code!
-#
-VBoxClient_LIBPATH  += $(PATH_VBoxClient)
-VBoxClient_ORDERDEPS = $(PATH_VBoxClient)/libstdc++.a
-VBoxClient_CLEAN     = $(PATH_VBoxClient)/libstdc++.a
-$$(PATH_VBoxClient)/libstdc++.a:
-	$(call MSG_L1,Forcing static libstdc++)
-	$(QUIET)$(MKDIR) -p $(@D)
-	$(QUIET)$(LN_EXT) -sf `$(TOOL_$(VBOX_GCC_TOOL)_CXX) $(TEMPLATE_VBOXGUESTR3CPPEXE_CXXFLAGS.$(KBUILD_TARGET_ARCH)) -print-file-name=libstdc++.a` $@ \
-	     || $(CP_EXT) -f  `$(TOOL_$(VBOX_GCC_TOOL)_CXX) $(TEMPLATE_VBOXGUESTR3CPPEXE_CXXFLAGS.$(KBUILD_TARGET_ARCH)) -print-file-name=libstdc++.a` $@
+##
+## Link aginst libstdc++.a. (http://www.trilithium.com/johan/2005/06/static-libstdc/).
+## (It would've been preferred to avoid features depending on libstdc++, of course...)
+##
+## Actually, this is darn annoying and will *NOT* be tolerated for any new code!
+##
+#VBoxClient_LIBPATH  += $(PATH_VBoxClient)
+#VBoxClient_ORDERDEPS = $(PATH_VBoxClient)/libstdc++.a
+#VBoxClient_CLEAN     = $(PATH_VBoxClient)/libstdc++.a
+#$$(PATH_VBoxClient)/libstdc++.a:
+#	$(call MSG_L1,Forcing static libstdc++)
+#	$(QUIET)$(MKDIR) -p $(@D)
+#	$(QUIET)$(LN_EXT) -sf `$(TOOL_$(VBOX_GCC_TOOL)_CXX) $(TEMPLATE_VBOXGUESTR3CPPEXE_CXXFLAGS.$(KBUILD_TARGET_ARCH)) -print-file-name=libstdc++.a` $@ \
+#	     || $(CP_EXT) -f  `$(TOOL_$(VBOX_GCC_TOOL)_CXX) $(TEMPLATE_VBOXGUESTR3CPPEXE_CXXFLAGS.$(KBUILD_TARGET_ARCH)) -print-file-name=libstdc++.a` $@
 
 ifdef VBOX_X11_SEAMLESS_GUEST
  if defined(VBOX_WITH_TESTCASES) && !defined(VBOX_ONLY_ADDITIONS) && !defined(VBOX_ONLY_SDK)
-- 
1.7.0.1

