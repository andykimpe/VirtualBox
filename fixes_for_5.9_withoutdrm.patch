This patch file contains the changes needed to compile the VirtualBox
modules for kernel 5.9.0+.

The changes are as follows:
1. The kernel headers no longer define HAVE_UNLOCKED_IOCTL; however,
   this symbol is needed for compilation of VB.
2. The calling sequence for get_user_pages_remote() is changed.
3. Routine sched_setscheduler() is replaced by sched_set_fifo_low().
4. The type of vbox_master_set() is changed from int to void.
5. Routine drm_gem_object_put_unlocked() is replaced by drm_gem_object_put().
6. Member offset is removed from struct ttm_buffer_object.

Index: VirtualBox-6.1.14/src/VBox/Runtime/r0drv/linux/the-linux-kernel.h
===================================================================
--- VirtualBox-6.1.14.orig/src/VBox/Runtime/r0drv/linux/the-linux-kernel.h
+++ VirtualBox-6.1.14/src/VBox/Runtime/r0drv/linux/the-linux-kernel.h
@@ -137,7 +137,10 @@
 #include <linux/interrupt.h>
 #include <linux/completion.h>
 #include <linux/compiler.h>
-#ifndef HAVE_UNLOCKED_IOCTL /* linux/fs.h defines this */
+#if RTLNX_VER_MIN(5, 9, 0)
+#define HAVE_UNLOCKED_IOCTL 1	/* defined in linux/fs.h for kernels before 5.9 */
+#endif
+#ifndef HAVE_UNLOCKED_IOCTL
 # include <linux/smp_lock.h>
 #endif
 /* For the shared folders module */
===================================================================
--- VirtualBox-6.1.14.orig/src/VBox/Runtime/r0drv/linux/memobj-r0drv-linux.c
+++ VirtualBox-6.1.14/src/VBox/Runtime/r0drv/linux/memobj-r0drv-linux.c
@@ -1181,7 +1181,9 @@ DECLHIDDEN(int) rtR0MemObjNativeLockUser
          */
         else
             rc = get_user_pages_remote(
+#if    RTLNX_VER_MAX(5, 9, 0)
                                 pTask,                  /* Task for fault accounting. */
+#endif
                                 pTask->mm,              /* Whose pages. */
                                 R3Ptr,                  /* Where from. */
                                 cPages,                 /* How many pages. */
Index: VirtualBox-6.1.14/src/VBox/Runtime/r0drv/linux/thread2-r0drv-linux.c
===================================================================
--- VirtualBox-6.1.14.orig/src/VBox/Runtime/r0drv/linux/thread2-r0drv-linux.c
+++ VirtualBox-6.1.14/src/VBox/Runtime/r0drv/linux/thread2-r0drv-linux.c
@@ -92,8 +92,12 @@ DECLHIDDEN(int) rtThreadNativeSetPriorit
             return VERR_INVALID_PARAMETER;
     }
 
+#if RTLNX_VER_MAX(5, 9, 0)
     sched_setscheduler(current, iSchedClass, &Param);
 #else
+    sched_set_fifo_low(current);
+#endif
+#else
     RT_NOREF_PV(enmType);
 #endif
     RT_NOREF_PV(pThread);
